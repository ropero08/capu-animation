function renderDists(){
  const container = $('distsContainer');
  container.innerHTML='';

  const email = localStorage.getItem('capu_current');
  let user = users[email];

  // Siempre 3 secciones
  user.dists = [
    user.dists[0] || {id:1,title:'Secci贸n 1',text:'',media:[]},
    user.dists[1] || {id:2,title:'Secci贸n 2',text:'',media:[]},
    user.dists[2] || {id:3,title:'Secci贸n 3',text:'',media:[]}
  ];
  localStorage.setItem('capu_users',JSON.stringify(users));

  user.dists.forEach((d,idx)=>{
    const box = document.createElement('div'); 
    box.className='dist';

    box.innerHTML = `
      <div class="hdr"><h3 contenteditable="true" class="dist-title">${d.title}</h3></div>
      <textarea class="desc">${d.text}</textarea>

      <div class="file-row">
        <label>Subir video
            <input type="file" accept="video/*" class="video-up" style="display:none">
        </label>

        <label>Subir PDF
            <input type="file" accept="application/pdf" class="pdf-up" style="display:none">
        </label>

        <button class="small-btn save-dist">Guardar</button>
      </div>

      <div class="preview"></div>
    `;

    container.appendChild(box);

    const videoUp = box.querySelector(".video-up");
    const pdfUp   = box.querySelector(".pdf-up");
    const preview = box.querySelector(".preview");
    const saveBtn = box.querySelector(".save-dist");

    // ---- PINTAR MEDIOS ----
    function paintMedia(){
      preview.innerHTML = "";

      d.media.forEach(m=>{
        if(m.type === "video"){
          const v = document.createElement("video");
          v.controls = true;
          v.src = m.url;
          v.style.maxHeight = "220px";
          preview.appendChild(v);
        }

        if(m.type === "pdf"){
          const link = document.createElement("a");
          link.href = m.url;
          link.textContent = "Abrir PDF ";
          link.target = "_blank";
          link.style.display = "block";
          link.style.padding = "8px";
          link.style.marginTop = "6px";
          link.style.background = "#f5f2f8";
          link.style.borderRadius = "10px";
          preview.appendChild(link);
        }
      });
    }
    paintMedia();

    // ---- SUBIR VIDEO ----
    videoUp.addEventListener("change", ev=>{
      const f = ev.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      d.media.push({type:"video", url});
      saveAndRerender();
    });

    // ---- SUBIR PDF ----
    pdfUp.addEventListener("change", ev=>{
      const f = ev.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      d.media.push({type:"pdf", url});
      saveAndRerender();
    });

    // ---- GUARDAR ----
    saveBtn.addEventListener("click", ()=>{
      d.title = box.querySelector(".dist-title").textContent.trim();
      d.text  = box.querySelector(".desc").value.trim();
      saveAndRerender();
      alert("Secci贸n guardada");
    });

    function saveAndRerender(){
      users[email].dists[idx] = d;
      localStorage.setItem("capu_users", JSON.stringify(users));
      renderDists();
    }
  });
}
