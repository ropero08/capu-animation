<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CAPU Animation</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#5b3f5b;
  --muted:#6b6464;
  --card:#ffffff;
  --soft-bg: rgba(255,255,255,0.92);
  --accent1:#f5d6e6;
  --accent2:#e8f2fb;
  --round:14px;
}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;font-family:'Poppins',system-ui,Roboto,Arial;color:var(--primary);background:linear-gradient(180deg,#fffaf6,#fff1e6);}

/* LANDING / LOGIN */
#landing-wrap{
  position:relative; min-height:100vh; display:flex; align-items:center; justify-content:center;
  background:linear-gradient(180deg,#fffaf6,#fff1e6); background-size:cover; background-position:center;
}
#landing-overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.18));backdrop-filter: blur(3px);}
.card-join{position:relative; z-index:2; width:92%; max-width:640px; padding:36px; border-radius:18px; background:var(--soft-bg); box-shadow:0 18px 50px rgba(20,10,30,0.12); text-align:center;}
.title{font-family:'Playfair Display',serif;font-size:42px;color:var(--primary);margin:0 0 6px 0}
.lead{color:var(--muted);margin-bottom:16px;font-size:15px}
.input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #efe6ee;margin-top:10px;font-size:15px}
.btn{display:inline-block;padding:12px 20px;border-radius:12px;background:linear-gradient(180deg,var(--accent1),#f1cfe1);border:none;font-weight:600;cursor:pointer;color:#3a233a;margin-top:14px;box-shadow:0 8px 22px rgba(100,60,100,0.08)}
.btn:hover{transform:translateY(-3px)}
.small-tip{font-size:13px;color:var(--muted);margin-top:12px}

/* APP HEADER */
header.app-header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(255,255,255,0.95);position:sticky;top:0;z-index:60;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(20,10,30,0.04)}
.logo-left{display:flex;align-items:center;gap:12px}
.logo-text{font-weight:700;font-size:20px;color:var(--primary);font-family:'Playfair Display',serif}
.user-area{display:flex;align-items:center;gap:12px}
.username{font-weight:600;color:var(--muted);font-size:14px}
.avatar{width:50px;height:50px;border-radius:50%;overflow:hidden;border:2px solid rgba(0,0,0,0.06);cursor:pointer}
.avatar img{width:100%;height:100%;object-fit:cover}

/* Layout */
.container{max-width:1100px;margin:22px auto;padding:0 18px}
.card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(20,10,30,0.04)}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:18px;align-items:start}
@media(max-width:980px){.grid{grid-template-columns:1fr}}

/* Distribution */
.dist{padding:16px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.96),#fff);min-height:260px;display:flex;flex-direction:column;gap:10px}
.dist .hdr{display:flex;align-items:center;justify-content:space-between;gap:10px}
.dist h3{margin:0;font-size:18px}
.desc{flex:1;margin-top:8px;padding:10px;border-radius:10px;border:1px solid #f0e7f1;min-height:70px;resize:vertical}
.file-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.file-row label{background:#fff;border:1px solid #efe6ee;padding:8px 10px;border-radius:10px;cursor:pointer}
.preview{margin-top:8px;border-radius:10px;overflow:hidden;background:#faf7fb;padding:8px;border:1px dashed #efe6ee}
.preview video,.preview iframe,.preview img{width:100%;height:auto;display:block;border-radius:8px}

/* Edit panel small */
.edit-panel{position:fixed;right:18px;bottom:18px;background:var(--card);padding:12px;border-radius:12px;box-shadow:0 12px 36px rgba(20,10,40,0.08);width:260px;z-index:80;transition:transform .18s ease,opacity .18s ease}
.edit-panel.hidden{transform:translateY(18px);opacity:0.02;pointer-events:none}
.edit-panel input[type=color], .edit-panel input[type=file]{display:block;margin:8px 0;width:100%}
.edit-panel .tiny{font-size:13px;color:var(--muted);margin-top:6px}
.small-btn{padding:8px 10px;border-radius:10px;border:1px solid #efe6ee;background:#fff;cursor:pointer}

/* footer */
.footer{text-align:center;color:var(--muted);padding:28px 0}

/* focus */
input:focus, textarea:focus, button:focus { outline: 3px solid rgba(165,122,166,0.12); outline-offset:3px }
</style>
</head>
<body>

<div id="landing-wrap">
  <div id="landing-overlay"></div>
  <div class="card-join">
    <div class="title">CAPU ANIMATION</div>
    <div class="lead">Comparte animaciones, formaciÃ³n y devociÃ³n en tonos delicados</div>

    <!-- LOGIN -->
    <input class="input" type="email" id="loginEmail" placeholder="Correo">
    <button class="btn" onclick="login()">Entrar</button>
    <hr>

    <!-- REGISTER -->
    <input id="regName" class="input" type="text" placeholder="Tu nombre completo">
    <input id="regEmail" class="input" type="email" placeholder="Tu correo (Gmail)">
    <label style="display:block;margin-top:8px;">Avatar:
      <input type="file" id="regAvatar" accept="image/*">
    </label>
    <button class="btn" onclick="register()">Crear cuenta y entrar</button>
    <div class="small-tip">Personaliza el fondo desde el panel ðŸŽ¨</div>
  </div>
</div>

<header class="app-header" id="appHeader" style="display:none">
  <div class="logo-left"><div class="logo-text">CAPU <span style="color:#a57aa6">Animation</span></div></div>
  <div class="user-area">
    <div class="username" id="displayName"></div>
    <div class="avatar" id="avatarWrap"><img id="avatarImg" src="https://via.placeholder.com/120?text=U"></div>
  </div>
  <button id="openPanelHeader" class="small-btn">ðŸŽ¨</button>
  <button id="logoutBtn" class="small-btn">Salir</button>
</header>

<main id="appMain" style="display:none">
  <div class="container">
    <section class="card" aria-label="Bienvenida">
      <h2>Bienvenid@, <span id="welcomeName" style="font-weight:700"></span></h2>
      <p style="color:var(--muted)">
        Bienvenido a Capu Animation, tu espacio de videos animados sobre los Santos Dominicos. 
        AquÃ­ podrÃ¡s explorar sus vidas, enseÃ±anzas y milagros a travÃ©s de animaciones divertidas y educativas. 
        Â¡Aprende, diviÃ©rtete y deja que la historia te inspire!
      </p>
    </section>

    <section class="card">
      <h3>Secciones principales</h3>
      <div class="grid" id="distsContainer"></div>
    </section>

    <footer class="footer">CAPU Animation â€” Guardado en tu navegador</footer>
  </div>
</main>

<div class="edit-panel hidden" id="editPanel">
  <div style="font-weight:700">ðŸŽ¨ Personalizar</div>
  <div class="tiny">Fondo Landing/Login</div>
  <input type="file" id="bgLandingFile" accept="image/*">
  <input type="color" id="bgLandingColor" value="#ffffff">
  <div style="display:flex;gap:8px;margin-top:8px">
    <button class="small-btn" id="applyBgLanding">Aplicar</button>
    <button class="small-btn" id="previewBgLanding">Vista previa</button>
    <button class="small-btn" id="clearBgLanding">Quitar</button>
  </div>
  <hr>
  <div class="tiny">Fondo App Principal</div>
  <input type="file" id="bgAppFile" accept="image/*">
  <input type="color" id="bgAppColor" value="#ffffff">
  <div style="display:flex;gap:8px;margin-top:8px">
    <button class="small-btn" id="applyBgApp">Aplicar</button>
    <button class="small-btn" id="previewBgApp">Vista previa</button>
    <button class="small-btn" id="clearBgApp">Quitar</button>
  </div>
  <hr>
  <div class="tiny">Avatar</div>
  <input type="file" id="avatarFile" accept="image/*">
  <div style="display:flex;gap:8px;margin-top:8px">
    <button class="small-btn" id="saveStyles">Guardar</button>
    <button class="small-btn" id="resetStyles">Reset</button>
  </div>
</div>

<script>
const $ = id=>document.getElementById(id);
let users = JSON.parse(localStorage.getItem('capu_users')||'{}');

// REGISTER
function register(){
  const name = $('regName').value.trim();
  const email = $('regEmail').value.trim().toLowerCase();
  if(!name||!email) return alert('Completa los campos');
  if(users[email]) return alert('Usuario ya existe');

  let avatar=null;
  const f=$('regAvatar').files[0];
  if(f){
    const fr=new FileReader();
    fr.onload=()=>{
      avatar=fr.result;
      saveUser(name,email,avatar);
    };
    fr.readAsDataURL(f);
  }else saveUser(name,email,null);
}

function saveUser(name,email,avatar){
  users[email]={name,email,avatar,dists:[]};
  localStorage.setItem('capu_users',JSON.stringify(users));
  localStorage.setItem('capu_current',email);
  initApp();
}

// LOGIN
function login(){
  const email=$('loginEmail').value.trim().toLowerCase();
  if(!users[email]) return alert('Usuario no existe');
  localStorage.setItem('capu_current',email);
  initApp();
}

// LOGOUT
function logout(){
  localStorage.removeItem('capu_current');
  location.reload();
}

// AVATAR
$('avatarFile').addEventListener('change',ev=>{
  const f=ev.target.files[0]; if(!f) return;
  const fr=new FileReader();
  fr.onload=()=>{
    const email = localStorage.getItem('capu_current');
    users[email].avatar=fr.result;
    localStorage.setItem('capu_users',JSON.stringify(users));
    $('avatarImg').src=fr.result;
  };
  fr.readAsDataURL(f);
});
$('avatarWrap').addEventListener('click',()=>$('avatarFile').click());

// PANEL TOGGLE
$('openPanelHeader').addEventListener('click',()=>$('editPanel').classList.toggle('hidden'));
$('saveStyles').addEventListener('click',()=>alert('Estilos guardados en tu navegador. Pulsa Aplicar.'));
$('resetStyles').addEventListener('click',()=>{localStorage.clear(); location.reload();});

// BACKGROUND LANDING
let stagedBgLanding={img:null,color:null};
$('bgLandingFile').addEventListener('change',ev=>{
  const f=ev.target.files[0]; if(!f) return;
  const fr=new FileReader();
  fr.onload=()=>{ stagedBgLanding.img=fr.result; alert('Imagen cargada. Vista previa o Aplicar.');};
  fr.readAsDataURL(f);
});
$('bgLandingColor').addEventListener('input',ev=>stagedBgLanding.color=ev.target.value);
$('previewBgLanding').addEventListener('click',()=>{
  if(stagedBgLanding.img) $('landing-wrap').style.backgroundImage=`url('${stagedBgLanding.img}')`;
  else if(stagedBgLanding.color) $('landing-wrap').style.background=stagedBgLanding.color;
});
$('applyBgLanding').addEventListener('click',()=>{
  if(stagedBgLanding.img){ localStorage.setItem('capu_landing_bg',stagedBgLanding.img); $('landing-wrap').style.backgroundImage=`url('${stagedBgLanding.img}')`; }
  else if(stagedBgLanding.color){ localStorage.setItem('capu_landing_bg_color',stagedBgLanding.color); $('landing-wrap').style.background=stagedBgLanding.color; }
});
$('clearBgLanding').addEventListener('click',()=>{
  localStorage.removeItem('capu_landing_bg'); localStorage.removeItem('capu_landing_bg_color');
  stagedBgLanding={img:null,color:null}; $('bgLandingFile').value=''; $('bgLandingColor').value='#ffffff';
  $('landing-wrap').style.background='linear-gradient(180deg,#fffaf6,#fff1e6)';
});

// BACKGROUND APP
let stagedBgApp={img:null,color:null};
$('bgAppFile').addEventListener('change',ev=>{
  const f=ev.target.files[0]; if(!f) return;
  const fr=new FileReader();
  fr.onload=()=>{ stagedBgApp.img=fr.result; alert('Imagen cargada. Vista previa o Aplicar.'); };
  fr.readAsDataURL(f);
});
$('bgAppColor').addEventListener('input',ev=>stagedBgApp.color=ev.target.value);
$('previewBgApp').addEventListener('click',()=>{
  if(stagedBgApp.img) $('appMain').style.backgroundImage=`url('${stagedBgApp.img}')`;
  else if(stagedBgApp.color) $('appMain').style.background=stagedBgApp.color;
});
$('applyBgApp').addEventListener('click',()=>{
  if(stagedBgApp.img){ localStorage.setItem('capu_app_bg',stagedBgApp.img); $('appMain').style.backgroundImage=`url('${stagedBgApp.img}')`; }
  else if(stagedBgApp.color){ localStorage.setItem('capu_app_bg_color',stagedBgApp.color); $('appMain').style.background=stagedBgApp.color; }
});
$('clearBgApp').addEventListener('click',()=>{
  localStorage.removeItem('capu_app_bg'); localStorage.removeItem('capu_app_bg_color');
  stagedBgApp={img:null,color:null}; $('bgAppFile').value=''; $('bgAppColor').value='#ffffff';
  $('appMain').style.background='linear-gradient(180deg,#fffaf6,#fff1e6)';
});

// INIT APP
function initApp(){
  const email = localStorage.getItem('capu_current');
  if(!email || !users[email]) return;
  const user = users[email];
  $('landing-wrap').style.display='none';
  $('appHeader').style.display='flex';
  $('appMain').style.display='block';
  $('welcomeName').textContent=user.name;
  $('displayName').textContent=user.name;
  $('avatarImg').src=user.avatar || 'https://via.placeholder.com/120?text=U';

  // Aplicar fondos guardados
  const bgLanding = localStorage.getItem('capu_landing_bg');
  const bgLandingC = localStorage.getItem('capu_landing_bg_color');
  if(bgLanding) $('landing-wrap').style.backgroundImage=`url('${bgLanding}')`;
  else if(bgLandingC) $('landing-wrap').style.background=bgLandingC;

  const bgApp = localStorage.getItem('capu_app_bg');
  const bgAppC = localStorage.getItem('capu_app_bg_color');
  if(bgApp) $('appMain').style.backgroundImage=`url('${bgApp}')`;
  else if(bgAppC) $('appMain').style.background=bgAppC;

  renderDists();
}

// DISTRIBUCIONES
function renderDists(){
  const container = $('distsContainer'); container.innerHTML='';
  const email = localStorage.getItem('capu_current');
  let user = users[email];
  if(user.dists.length===0) user.dists = [{id:1,title:'SecciÃ³n 1',text:'',media:[]},{id:2,title:'SecciÃ³n 2',text:'',media:[]},{id:3,title:'SecciÃ³n 3',text:'',media:[]}];
  localStorage.setItem('capu_users',JSON.stringify(users));
  user.dists.forEach((d,idx)=>{
    const box=document.createElement('div'); box.className='dist';
    box.innerHTML=`
      <div class="hdr"><h3 contenteditable="true
