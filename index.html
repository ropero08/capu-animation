<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CAPU Animation</title>

<!-- FUENTES -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#5b3f5b;
  --bg:#f7f3f9;
}

body{
  margin:0;
  font-family:Poppins, sans-serif;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
}

/* CONTENEDOR PRINCIPAL */
.container{
  max-width:900px;
  margin:40px auto;
  padding:20px;
  background:#ffffffcc;
  backdrop-filter:blur(6px);
  border-radius:20px;
  box-shadow:0 0 20px #0003;
}

/* TITULOS */
h1,h2{
  font-family:"Playfair Display", serif;
  color:var(--primary);
  text-align:center;
}

/* CAMPOS */
input[type="text"],
input[type="email"],
input[type="file"],
textarea{
  width:100%;
  padding:10px;
  margin:10px 0;
  border-radius:10px;
  border:1px solid #aaa;
  font-size:16px;
}

/* BOTONES */
button{
  width:100%;
  padding:12px;
  background:var(--primary);
  border:none;
  color:white;
  border-radius:10px;
  font-size:18px;
  cursor:pointer;
  margin-top:10px;
}
button:hover{opacity:.9;}

.section{
  margin-top:20px;
  padding:15px;
  border-radius:15px;
  background:#f1e6f7;
}

.media-item{
  margin:5px 0;
  padding:10px;
  background:white;
  border-radius:10px;
  border:1px solid #ddd;
  cursor:pointer;
}

label{font-weight:600;}
</style>
</head>
<body>

<div class="container" id="authBox">
  <h1>CAPU Animation</h1>

  <h2>Iniciar Sesión</h2>
  <input id="loginEmail" type="email" placeholder="Correo">
  <button onclick="login()">Entrar</button>

  <hr>

  <h2>Crear Cuenta</h2>
  <input id="regName" type="text" placeholder="Nombre">
  <input id="regEmail" type="email" placeholder="Correo">
  <button onclick="register()">Registrar</button>
</div>

<div class="container" id="app" style="display:none;">
  <h1>Bienvenido</h1>

  <h2>Fondo Personalizado</h2>
  <input id="bgInput" type="file" accept="image/*" onchange="setBackground(event)">

  <div id="sections"></div>
</div>

<script>
/* ---------------------------
   SISTEMA DE LOGIN SIMPLE
----------------------------*/
function register(){
  const name=document.getElementById("regName").value;
  const email=document.getElementById("regEmail").value;
  if(!name || !email) return alert("Completa todos los campos");

  const user={
    name,email,
    bg:null,
    sections:[
      {id:1,title:"Sección 1",text:"",media:[]},
      {id:2,title:"Sección 2",text:"",media:[]},
      {id:3,title:"Sección 3",text:"",media:[]}
    ]
  };

  localStorage.setItem("capuUser",JSON.stringify(user));
  alert("Cuenta creada. Ahora inicia sesión.");
}

function login(){
  const email=document.getElementById("loginEmail").value;
  const user=JSON.parse(localStorage.getItem("capuUser")||"null");

  if(!user || user.email!==email) return alert("Usuario no encontrado");
  
  startApp();
}

/* ---------------------------
        INICIAR APP
----------------------------*/
function startApp(){
  const user=JSON.parse(localStorage.getItem("capuUser"));

  document.getElementById("authBox").style.display="none";
  document.getElementById("app").style.display="block";

  if(user.bg) document.body.style.backgroundImage=`url(${user.bg})`;

  renderSections();
}

/* ---------------------------
        FONDO PERSONALIZADO
----------------------------*/
function setBackground(ev){
  const file=ev.target.files[0];
  const reader=new FileReader();

  reader.onload=function(e){
    const user=JSON.parse(localStorage.getItem("capuUser"));
    user.bg=e.target.result;
    document.body.style.backgroundImage=`url(${user.bg})`;
    localStorage.setItem("capuUser",JSON.stringify(user));
  };

  reader.readAsDataURL(file);
}

/* ---------------------------
        RENDER DE SECCIONES
----------------------------*/
function renderSections(){
  const user=JSON.parse(localStorage.getItem("capuUser"));
  const box=document.getElementById("sections");
  box.innerHTML="";

  user.sections.forEach(sec=>{
    const div=document.createElement("div");
    div.className="section";

    div.innerHTML=`
      <h2>${sec.title}</h2>

      <label>Texto:</label>
      <textarea id="txt${sec.id}" rows="3">${sec.text}</textarea>
      <button onclick="saveText(${sec.id})">Guardar texto</button>

      <label>Subir Video o PDF:</label>
      <input type="file" accept="video/*,application/pdf" onchange="uploadMedia(event,${sec.id})">

      <h3>Archivos:</h3>
      <div id="med${sec.id}">
        ${sec.media.map(m=>`
          <div class="media-item" onclick="openMedia('${m.data}','${m.type}')">${m.name}</div>
        `).join("")}
      </div>
    `;

    box.appendChild(div);
  });
}

/* ---------------------------
      GUARDAR TEXTO
----------------------------*/
function saveText(id){
  const user=JSON.parse(localStorage.getItem("capuUser"));
  const sec=user.sections.find(s=>s.id===id);
  sec.text=document.getElementById("txt"+id).value;
  localStorage.setItem("capuUser",JSON.stringify(user));
  alert("Guardado");
}

/* ---------------------------
      SUBIR VIDEO O PDF
----------------------------*/
function uploadMedia(ev,id){
  const file=ev.target.files[0];
  if(!file) return;

  const reader=new FileReader();

  reader.onload=function(e){
    const user=JSON.parse(localStorage.getItem("capuUser"));
    const sec=user.sections.find(s=>s.id===id);

    sec.media.push({
      name:file.name,
      data:e.target.result,
      type:file.type
    });

    localStorage.setItem("capuUser",JSON.stringify(user));
    renderSections();
  };

  reader.readAsDataURL(file);
}

/* ---------------------------
        ABRIR ARCHIVOS
----------------------------*/
function openMedia(data,type){
  const win=window.open();
  if(type==="application/pdf"){
    win.document.write(`<embed src="${data}" width="100%" height="100%">`);
  }else{
    win.document.write(`<video src="${data}" controls autoplay style="width:100%;height:100%"></video>`);
  }
}
</script>

</body>
</html>
