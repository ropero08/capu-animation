<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CAPU Animation</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#5b3f5b;
  --muted:#6b6464;
  --card:#ffffff;
  --soft-bg: rgba(255,255,255,0.92);
  --round:14px;
}

*{box-sizing:border-box;}
html,body{height:100%;margin:0;font-family:'Poppins';background:#fff7f2;color:var(--primary);}

#landing-wrap{
  position:relative;height:100vh;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg,#fffaf6,#fff1e6);
}
#landing-overlay{position:absolute;inset:0;background:rgba(255,255,255,0.2);backdrop-filter:blur(4px);}
.card-join{position:relative;z-index:3;background:var(--soft-bg);padding:34px;border-radius:18px;max-width:480px;width:92%;text-align:center;box-shadow:0 12px 38px rgba(0,0,0,0.1);}

.input{width:100%;padding:12px;border:1px solid #eee;border-radius:12px;margin:8px 0;}
.btn{background:#f3d3e8;padding:12px 20px;border:none;border-radius:12px;font-weight:600;margin-top:10px;cursor:pointer;}

header.app-header{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 20px;background:#fff;position:sticky;top:0;z-index:50;
  box-shadow:0 4px 18px rgba(0,0,0,0.05);
}
.avatar{width:50px;height:50px;border-radius:50%;overflow:hidden;border:2px solid #eee;cursor:pointer;}

.container{max-width:900px;margin:20px auto;padding:0 16px;}
.card{background:#fff;padding:20px;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,0.05);margin-bottom:20px;}

.sections-grid{
  display:grid;grid-template-columns:repeat(3,1fr);gap:16px;
}
.section-box{
  background:#fff;padding:20px;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,0.05);
  cursor:pointer;transition:.2s;
}
.section-box:hover{transform:translateY(-4px);}

/* MODAL */
#modal{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.55);display:none;
  align-items:center;justify-content:center;z-index:200;
}
.modal-content{
  background:#fff;width:92%;max-width:700px;
  border-radius:14px;padding:20px;
  max-height:90vh;overflow:auto;
}
.close-modal{float:right;font-size:22px;cursor:pointer;}

.preview video, .preview iframe{
  width:100%;margin-top:10px;border-radius:10px;
}
</style>
</head>
<body>

<div id="landing-wrap">
  <div id="landing-overlay"></div>
  <div class="card-join">
    <h2>CAPU ANIMATION</h2>
    <input id="loginEmail" class="input" placeholder="Correo">
    <button class="btn" onclick="login()">Entrar</button>
    <hr>
    <input id="regName" class="input" placeholder="Tu nombre">
    <input id="regEmail" class="input" placeholder="Tu correo (gmail)">
    <button class="btn" onclick="register()">Crear cuenta</button>
  </div>
</div>

<header class="app-header" id="appHeader" style="display:none">
  <h2>CAPU Animation</h2>
  <div style="display:flex;align-items:center;gap:10px">
    <div id="displayName"></div>
    <div class="avatar" id="avatarWrap"><img id="avatarImg" src="https://via.placeholder.com/120"></div>
    <button onclick="logout()" class="btn" style="padding:8px 14px">Salir</button>
  </div>
</header>

<main id="mainApp" style="display:none">
  <div class="container">

    <div class="card">
      <h3>Tres Secciones</h3>
      <p>Toca una sección para abrirla.</p>

      <div class="sections-grid">
        <div class="section-box" onclick="openSection(0)">Sección 1</div>
        <div class="section-box" onclick="openSection(1)">Sección 2</div>
        <div class="section-box" onclick="openSection(2)">Sección 3</div>
      </div>
    </div>

  </div>
</main>

<!-- MODAL -->
<div id="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal()">×</span>
    <h2 id="modalTitle"></h2>

    <textarea id="modalText" style="width:100%;height:120px;margin-top:10px;border-radius:10px;padding:10px"></textarea>

    <h3>Subir video</h3>
    <input type="file" id="videoInput" accept="video/*">

    <h3>Subir PDF</h3>
    <input type="file" id="pdfInput" accept="application/pdf">

    <button class="btn" onclick="saveSection()" style="margin-top:10px;width:100%">Guardar</button>

    <div class="preview" id="previewArea" style="margin-top:20px"></div>
  </div>
</div>
<script>
const $ = id => document.getElementById(id);
let users = JSON.parse(localStorage.getItem("capu_users") || "{}");
let current = null;
let currentSection = 0;

function register(){
  const name = $('regName').value.trim();
  const email = $('regEmail').value.trim();

  if(!name || !email) return alert("Completa todo");
  if(users[email]) return alert("Ya existe");

  users[email] = {
    name,
    email,
    avatar:null,
    sections:[
      {text:"", video:null, pdf:null},
      {text:"", video:null, pdf:null},
      {text:"", video:null, pdf:null}
    ]
  };

  localStorage.setItem("capu_users", JSON.stringify(users));
  localStorage.setItem("capu_current", email);
  init();
}

function login(){
  const email = $('loginEmail').value.trim();
  if(!users[email]) return alert("No existe");
  localStorage.setItem("capu_current", email);
  init();
}

function logout(){
  localStorage.removeItem("capu_current");
  location.reload();
}

function init(){
  current = localStorage.getItem("capu_current");
  if(!current) return;

  const u = users[current];

  $('landing-wrap').style.display="none";
  $('appHeader').style.display="flex";
  $('mainApp').style.display="block";

  $('displayName').textContent = u.name;
  $('avatarImg').src = u.avatar || "https://via.placeholder.com/120";
}

$('avatarWrap').onclick = ()=>{
  let inp = document.createElement("input");
  inp.type="file"; inp.accept="image/*";
  inp.onchange = e=>{
    let f = e.target.files[0];
    let reader = new FileReader();
    reader.onload = ()=>{
      users[current].avatar = reader.result;
      localStorage.setItem("capu_users", JSON.stringify(users));
      $('avatarImg').src = reader.result;
    }
    reader.readAsDataURL(f);
  }
  inp.click();
};

function openSection(n){
  currentSection = n;
  let sec = users[current].sections[n];

  $('modalTitle').textContent = "Sección " + (n+1);
  $('modalText').value = sec.text || "";

  renderPreview(sec);

  $('modal').style.display="flex";

  $('videoInput').value="";
  $('pdfInput').value="";
}

function closeModal(){
  $('modal').style.display="none";
}

function renderPreview(sec){
  let p = $('previewArea');
  p.innerHTML="";

  if(sec.video){
    let v = document.createElement("video");
    v.controls = true;
    v.src = sec.video;
    p.appendChild(v);
  }

  if(sec.pdf){
    let f = document.createElement("iframe");
    f.src = sec.pdf;
    f.style.height="300px";
    p.appendChild(f);
  }
}

function saveSection(){
  let sec = users[current].sections[currentSection];

  sec.text = $('modalText').value;

  let vfile = $('videoInput').files[0];
  if(vfile){
    sec.video = URL.createObjectURL(vfile);
  }

  let pfile = $('pdfInput').files[0];
  if(pfile){
    sec.pdf = URL.createObjectURL(pfile);
  }

  users[current].sections[currentSection] = sec;

  localStorage.setItem("capu_users", JSON.stringify(users));

  alert("Guardado");
  renderPreview(sec);
}
</script>
</body>
</html>
