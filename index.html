<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CAPU Animation</title>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;700&family=Montserrat:ital,wght@0,400;0,700;1,600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fffaf6;
      --card:#fff;
      --accent:#f7d6d0;
      --muted:#6b6464;
      --soft:#f3eefc;
      --pastel1: #fbe8e6;
      --pastel2: #e8f6f3;
      --pastel3: #fff1e6;
      --glass: rgba(255,255,255,0.8);
    }
    *{box-sizing:border-box}
    body{font-family:'Josefin Sans', system-ui, sans-serif; margin:0; background:linear-gradient(180deg,var(--pastel2),var(--pastel3)); color:#2b2b2b}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px}
    .logo{font-family:'Montserrat';font-weight:700;color:#5b4b4b;font-size:34px;letter-spacing:1px}
    .sub{font-size:12px;color:var(--muted);}
    .hero{padding:40px 28px; text-align:center}
    .bigtitle{font-family:'Montserrat';font-size:64px;color:#5b4b4b;margin:8px 0}
    .lead{max-width:800px;margin:0 auto;color:#4b3f3f}

    /* Buttons */
    .btn{display:inline-block;padding:10px 18px;border-radius:14px;background:var(--pastel1);border:1px solid rgba(0,0,0,0.06);cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(0,0,0,0.08)}

    /* Layout */
    .container{max-width:1100px;margin:20px auto;padding:18px}
    .card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 6px 18px rgba(58,50,50,0.06)}

    /* Nav when logged */
    .nav{display:flex;gap:12px;align-items:center}
    .search{padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.08);min-width:260px}
    .user-pill{display:flex;gap:10px;align-items:center}
    .avatar{width:44px;height:44px;border-radius:50%;overflow:hidden;border:2px solid rgba(0,0,0,0.05)}
    .avatar img{width:100%;height:100%;object-fit:cover}

    /* grid for distributions */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:18px}
    .dist{padding:12px;border-radius:12px;background:linear-gradient(180deg,var(--glass),#fff);min-height:260px}
    .dist h3{margin:0 0 10px 0}
    .dist .videos{margin-top:10px;display:flex;flex-direction:column;gap:12px}
    .vid{display:flex;gap:12px;align-items:flex-start}
    .vid video{width:160px;border-radius:8px}
    .vid .meta{flex:1}
    .meta p{margin:4px 0}

    /* editor */
    .editable{padding:6px;border-radius:8px;border:1px dashed rgba(0,0,0,0.04);background:transparent}
    .controls{display:flex;gap:8px;margin-top:10px}

    /* responsive */
    @media(max-width:900px){.grid{grid-template-columns:1fr}.bigtitle{font-size:44px}}
  </style>
</head>
<body>
  <!-- Simple static GitHub Pages-ready single file. All data is stored in localStorage. -->

  <!-- Landing / header -->
  <header>
    <div class="logo">CAPU <span style="color:#7a6b6b">Animation</span></div>
    <div id="topRight" class="nav">
      <!-- Buttons shown before login -->
      <button id="btnCreate" class="btn">Crear cuenta</button>
    </div>
  </header>

  <main>
    <section id="landing" class="hero">
      <div class="bigtitle">CAPU Animation</div>
      <p class="lead">Un espacio para compartir videos, documentos y la devoción dominicana. Colores en tonos pastel, posibilidad de editar contenido y subir tus propios videos y PDFs.</p>
      <div style="margin-top:20px">
        <button id="openCreate" class="btn">Crear cuenta con correo</button>
      </div>
      <div style="margin-top:26px;display:flex;gap:10px;justify-content:center;align-items:center">
        <!-- Decorative saint images (replace with your own if you prefer) -->
        <a href="https://www.metmuseum.org/art/collection/search/436054" target="_blank" title="Saint Dominic (Met)"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/57/Saint_Dominic_-_Carlo_Crivelli.jpg/160px-Saint_Dominic_-_Carlo_Crivelli.jpg" alt="Santo Dominico" width="120" style="border-radius:12px;box-shadow:0 6px 12px rgba(0,0,0,0.06)"></a>
        <a href="https://en.wikipedia.org/wiki/Saint_Dominic" target="_blank" title="Saint Dominic (Wikipedia)"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/El_Greco_St_Dominic.jpg/160px-El_Greco_St_Dominic.jpg" alt="El Greco - Santo" width="120" style="border-radius:12px;box-shadow:0 6px 12px rgba(0,0,0,0.06)"></a>
        <a href="https://advancingwomenartists.org/artists/plautilla-nelli/saint-dominic-receives-the-rosary" target="_blank" title="Saint Dominic receives the Rosary"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Saint_Dominic_and_Virgin.jpg/160px-Saint_Dominic_and_Virgin.jpg" alt="Rosario" width="120" style="border-radius:12px;box-shadow:0 6px 12px rgba(0,0,0,0.06)"></a>
      </div>
    </section>

    <!-- Register modal (simple) -->
    <div id="registerModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);align-items:center;justify-content:center;">
      <div class="card" style="width:360px;margin:auto">
        <h3>Crear cuenta</h3>
        <p class="sub">Por favor ingresa tu correo. Con eso iniciarás sesión en esta demo.</p>
        <input id="emailInput" type="email" placeholder="tu@correo.com" style="width:100%;padding:10px;border-radius:8px;margin-top:8px;border:1px solid #eee">
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
          <button id="cancelReg" class="btn secondary">Cancelar</button>
          <button id="submitReg" class="btn">Crear y entrar</button>
        </div>
      </div>
    </div>

    <!-- Main app (hidden until login) -->
    <section id="app" style="display:none">
      <div class="container">
        <div class="card" style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-size:20px;font-weight:700">Bienvenid@, <span id="userName">usuario</span></div>
            <div class="sub">Propósito: compartir animaciones, documentos y material devocional dominicano.</div>
          </div>
          <div style="display:flex;align-items:center;gap:12px">
            <input id="searchBox" class="search" placeholder="Buscar videos, títulos..." style="display:none">
            <div class="user-pill">
              <div style="text-align:right;margin-right:8px" id="userEmail"></div>
              <div class="avatar"><img id="avatarImg" src="https://via.placeholder.com/80?text=U" alt="avatar"></div>
            </div>
          </div>
        </div>

        <!-- Editable purpose -->
        <div style="margin-top:16px" class="card">
          <h3>Propósito de la página</h3>
          <div id="purposeText" class="editable" contenteditable="true">Aquí puedes escribir el propósito de tu sitio. Haz clic y edita este texto. Luego haz clic en "Guardar".</div>
          <div class="controls">
            <button id="savePurpose" class="btn">Guardar</button>
            <button id="resetPurpose" class="btn secondary">Restablecer</button>
          </div>
        </div>

        <!-- Distributions grid -->
        <div style="margin-top:18px" class="card">
          <h3>Distribuciones</h3>
          <p class="sub">Cada distribución puede contener videos, un texto pequeño y un PDF. Puedes editar todo.</p>

          <div class="grid" id="distsContainer">
            <!-- Three distributions generated by JS -->
          </div>
        </div>

      </div>
    </section>

    <footer style="padding:28px;text-align:center;color:var(--muted)">CAPU Animation • Demo local • Guarda tu navegador para volver a entrar</footer>
  </main>

  <script>
    // --- Simple client-side "auth" using localStorage ---
    const btnCreate = document.getElementById('openCreate');
    const registerModal = document.getElementById('registerModal');
    const cancelReg = document.getElementById('cancelReg');
    const submitReg = document.getElementById('submitReg');
    const emailInput = document.getElementById('emailInput');
    const landing = document.getElementById('landing');
    const app = document.getElementById('app');
    const topRight = document.getElementById('topRight');
    const btnCreateMain = document.getElementById('btnCreate');

    function showRegister(){ registerModal.style.display='flex'; }
    function hideRegister(){ registerModal.style.display='none'; }

    btnCreate.addEventListener('click', showRegister);
    btnCreateMain.addEventListener('click', showRegister);
    cancelReg.addEventListener('click', hideRegister);

    submitReg.addEventListener('click', ()=>{
      const email = emailInput.value.trim();
      if(!email.includes('@')){ alert('Ingresa un correo válido.'); return; }
      const user = {email, name: email.split('@')[0], avatar: null};
      localStorage.setItem('capu_user', JSON.stringify(user));
      hideRegister();
      initApp();
    });

    // --- App logic ---
    function initApp(){
      const userStr = localStorage.getItem('capu_user');
      if(!userStr) return;
      const user = JSON.parse(userStr);
      landing.style.display='none';
      app.style.display='block';
      document.getElementById('userName').textContent = user.name || 'Usuario';
      document.getElementById('userEmail').textContent = user.email;

      // show search only after login
      document.getElementById('searchBox').style.display='inline-block';

      // change top-right: show logout & upload avatar
      topRight.innerHTML = `
        <input id="avatarUpload" type="file" accept="image/*" style="display:none">
        <button id="btnLogout" class="btn secondary">Salir</button>
      `;
      document.getElementById('btnLogout').addEventListener('click', ()=>{ localStorage.removeItem('capu_user'); location.reload(); });
      const avatarUpload = document.getElementById('avatarUpload');
      avatarUpload.addEventListener('change', (e)=>{
        const f = e.target.files[0];
        if(!f) return;
        const url = URL.createObjectURL(f);
        document.getElementById('avatarImg').src = url;
        const u = JSON.parse(localStorage.getItem('capu_user'));
        u.avatar = url; // note: this URL will be session-bound; for real hosting you'd upload it
        localStorage.setItem('capu_user', JSON.stringify(u));
      });

      // clicking avatar opens file selector
      document.querySelector('.avatar').addEventListener('click', ()=> avatarUpload.click());

      // load purpose if saved
      const savedPurpose = localStorage.getItem('capu_purpose');
      if(savedPurpose) document.getElementById('purposeText').textContent = savedPurpose;

      document.getElementById('savePurpose').addEventListener('click', ()=>{
        const txt = document.getElementById('purposeText').textContent;
        localStorage.setItem('capu_purpose', txt);
        alert('Propósito guardado.');
      });
      document.getElementById('resetPurpose').addEventListener('click', ()=>{
        document.getElementById('purposeText').textContent = 'Aquí puedes escribir el propósito de tu sitio. Haz clic y edita este texto. Luego haz clic en "Guardar".';
        localStorage.removeItem('capu_purpose');
      });

      // generate distributions
      const dcont = document.getElementById('distsContainer');
      const dists = JSON.parse(localStorage.getItem('capu_dists') || 'null') || [
        {id:1,title:'Distribución 1', videos:[]},
        {id:2,title:'Distribución 2', videos:[]},
        {id:3,title:'Distribución 3', videos:[]}
      ];

      function saveDists(){ localStorage.setItem('capu_dists', JSON.stringify(dists)); }

      function renderDists(){ dcont.innerHTML='';
        dists.forEach((d, idx)=>{
          const el = document.createElement('div'); el.className='dist card';
          el.innerHTML = `
            <h3 contenteditable="true" class="dist-title">${d.title}</h3>
            <div>
              <small class="sub">Texto pequeño (editable):</small>
              <div contenteditable="true" class="editable dist-text">${d.text||'Agrega un breve texto descriptivo aquí.'}</div>
            </div>
            <div style="margin-top:8px">
              <label class="btn">Subir video <input type="file" accept="video/*" style="display:none" class="video-uploader"></label>
              <label class="btn">Subir PDF <input type="file" accept="application/pdf" style="display:none" class="pdf-uploader"></label>
              <button class="btn secondary save-dist">Guardar sección</button>
            </div>
            <div class="videos"></div>
          `;
          // append
          dcont.appendChild(el);

          // populate existing videos
          const videosDiv = el.querySelector('.videos');
          (d.videos||[]).forEach(v=>{
            const vEl = document.createElement('div'); vEl.className='vid';
            vEl.innerHTML = `
              <video controls src="${v.videoURL}"></video>
              <div class="meta">
                <strong contenteditable="true" class="vtitle">${v.title||'Sin título'}</strong>
                <p contenteditable="true" class="vdesc">${v.desc||''}</p>
                <div><a href="${v.pdfURL||'#'}" target="_blank" class="pdfLink">PDF</a></div>
                <div style="margin-top:6px"><button class="btn secondary removeVid">Eliminar</button></div>
              </div>
            `;
            videosDiv.appendChild(vEl);
            vEl.querySelector('.removeVid').addEventListener('click', ()=>{
              const i = d.videos.indexOf(v);
              if(i>-1){ d.videos.splice(i,1); saveDists(); renderDists(); }
            });
          });

          // handlers
          const vupload = el.querySelector('.video-uploader');
          const pupload = el.querySelector('.pdf-uploader');
          const saveBtn = el.querySelector('.save-dist');

          vupload.addEventListener('change', (e)=>{
            const f = e.target.files[0]; if(!f) return;
            const url = URL.createObjectURL(f);
            // create a new video entry with optional title/desc
            const newV = {videoURL:url, title:f.name, desc:'Describe este video', pdfURL:null};
            d.videos = d.videos || [];
            d.videos.push(newV); saveDists(); renderDists();
          });

          pupload.addEventListener('change', (e)=>{
            const f = e.target.files[0]; if(!f) return;
            const url = URL.createObjectURL(f);
            // attach to last video or create a placeholder
            d.videos = d.videos || [];
            if(d.videos.length===0){ d.videos.push({videoURL:'', title:'Archivo PDF', desc:'', pdfURL:url}); }
            else { d.videos[d.videos.length-1].pdfURL = url; }
            saveDists(); renderDists();
          });

          saveBtn.addEventListener('click', ()=>{
            d.title = el.querySelector('.dist-title').textContent.trim();
            d.text = el.querySelector('.dist-text').textContent.trim();
            saveDists(); alert('Sección guardada.');
          });
        });
      }

      renderDists();

      // search
      const searchBox = document.getElementById('searchBox');
      searchBox.addEventListener('input', ()=>{
        const q = searchBox.value.toLowerCase();
        // naive filter: hide distributions without match
        dcont.querySelectorAll('.dist').forEach((el,i)=>{
          const t = el.querySelector('.dist-title').textContent + ' ' + el.querySelector('.dist-text').textContent;
          el.style.display = t.toLowerCase().includes(q) ? '' : 'none';
        });
      });

    }

    // on load, check if user exists
    window.addEventListener('DOMContentLoaded', ()=>{
      if(localStorage.getItem('capu_user')){
        initApp();
      }

      // convenience: press L to open login modal
      window.addEventListener('keydown', (e)=>{ if(e.key==='l' || e.key==='L') showRegister(); });
    });
  </script>
</body>
</html>
