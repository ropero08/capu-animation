<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CAPU Animation</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

<style>
/* ======= TU ESTILO ORIGINAL, NO MODIFICADO ======= */
:root{
  --primary:#5b3f5b;
  --muted:#6b6464;
  --card:#ffffff;
  --soft-bg: rgba(255,255,255,0.92);
  --accent1:#f5d6e6;
  --accent2:#e8f2fb;
  --round:14px;
}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;font-family:'Poppins',system-ui,Roboto,Arial;color:var(--primary);background:linear-gradient(180deg,#fffaf6,#fff1e6);}

/* LANDING */
#landing-wrap{
  position:relative; min-height:100vh; display:flex; align-items:center; justify-content:center;
  background-size:cover; background-position:center;
}
#landing-overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.18));backdrop-filter: blur(3px);}

.card-join{position:relative; z-index:2; width:92%; max-width:640px; padding:36px; border-radius:18px; background:var(--soft-bg); box-shadow:0 18px 50px rgba(20,10,30,0.12); text-align:center;}
.title{font-family:'Playfair Display',serif;font-size:42px;color:var(--primary);margin:0 0 6px 0}
.lead{color:var(--muted);margin-bottom:16px;font-size:15px}
.input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #efe6ee;margin-top:10px;font-size:15px}
.btn{padding:12px 20px;border-radius:12px;background:linear-gradient(180deg,var(--accent1),#f1cfe1);border:none;font-weight:600;cursor:pointer;color:#3a233a;margin-top:14px}
.btn:hover{transform:translateY(-3px)}

/* HEADER */
header.app-header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(255,255,255,0.95);position:sticky;top:0;z-index:60;backdrop-filter:blur(6px);}

/* MAIN */
.container{max-width:1100px;margin:22px auto;padding:0 18px}
.card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(20,10,30,0.04)}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:18px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}

/* SECCIONES */
.dist{padding:16px;border-radius:12px;background:#fff;min-height:260px;display:flex;flex-direction:column;gap:10px}
.dist h3{margin:0;font-size:18px}
.desc{flex:1;margin-top:8px;padding:10px;border-radius:10px;border:1px solid #f0e7f1;min-height:70px}
.file-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.file-row label{background:#fff;border:1px solid #efe6ee;padding:8px 10px;border-radius:10px;cursor:pointer}

/* PREVIEW â€” MEJORADO */
.preview{margin-top:8px;border-radius:10px;background:#faf7fb;padding:8px;border:1px dashed #efe6ee}
.preview-item{cursor:pointer;margin-bottom:10px}
.preview-item:hover{opacity:0.8}

/* MODAL NUEVO â€” ABRIR PDF Y VIDEO */
#modalView{
  position:fixed; inset:0; background:rgba(0,0,0,0.7);
  display:none; justify-content:center; align-items:center; z-index:200;
}
#modalBox{
  background:#fff; padding:15px; border-radius:12px;
  width:90%; max-width:900px; max-height:90vh; overflow:auto;
}
#closeModal{background:red;color:#fff;padding:6px 12px;border:none;border-radius:8px;cursor:pointer;float:right}

</style>
</head>

<body>

<!-- ========== LOGIN ========== -->
<div id="landing-wrap">
  <div id="landing-overlay"></div>
  <div class="card-join">
    <div class="title">CAPU ANIMATION</div>

    <input class="input" id="regName" placeholder="Nombre">
    <input class="input" id="regEmail" placeholder="Correo Gmail">

    <button class="btn" onclick="register()">Crear cuenta</button>
    <hr>

    <input class="input" id="loginEmail" placeholder="Ingresa tu correo">
    <button class="btn" onclick="login()">Entrar</button>
  </div>
</div>

<!-- ========== HEADER ========== -->
<header class="app-header" id="appHeader" style="display:none">
  <div class="logo-text">CAPU ANIMATION</div>
  <div style="display:flex;gap:10px;align-items:center;">
    <div class="username" id="displayName"></div>
    <div class="avatar" id="avatarWrap">
      <img id="avatarImg" src="https://via.placeholder.com/120?text=U" style="width:50px;height:50px;border-radius:50%">
    </div>
    <input type="file" id="avatarFile" style="display:none" accept="image/*">
    <button class="btn" style="padding:6px 10px" onclick="logout()">Salir</button>
  </div>
</header>

<!-- ========== MAIN APP ========== -->
<main id="appMain" style="display:none">
  <div class="container">

    <section class="card">
      <h2>Bienvenido, <span id="welcomeName"></span></h2>
    </section>

    <section class="card">
      <h3>Secciones</h3>
      <div class="grid" id="distsContainer"></div>
    </section>

  </div>
</main>

<!-- ========== MODAL PARA VIDEOS/PDF ========== -->
<div id="modalView">
  <div id="modalBox">
    <button id="closeModal">Cerrar</button>
    <div id="modalContent"></div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
let users = JSON.parse(localStorage.getItem("capu_users") || "{}");

/* ============= LOGIN / REGISTER ============= */
function register(){
  let name = $("regName").value.trim();
  let email = $("regEmail").value.trim();
  if(!name||!email) return alert("Llena todos los campos");
  users[email] = {name,email,avatar:null,dists:[
    {id:1,title:"SecciÃ³n 1",text:"",media:[]},
    {id:2,title:"SecciÃ³n 2",text:"",media:[]},
    {id:3,title:"SecciÃ³n 3",text:"",media:[]}
  ]};
  localStorage.setItem("capu_users",JSON.stringify(users));
  localStorage.setItem("capu_current",email);
  initApp();
}

function login(){
  let email = $("loginEmail").value.trim();
  if(!users[email]) return alert("Usuario no existe");
  localStorage.setItem("capu_current",email);
  initApp();
}

function logout(){
  localStorage.removeItem("capu_current");
  location.reload();
}

/* ============= INICIAR APP ============= */
function initApp(){
  const email = localStorage.getItem("capu_current");
  const user = users[email];

  $("landing-wrap").style.display = "none";
  $("appHeader").style.display = "flex";
  $("appMain").style.display = "block";

  $("displayName").textContent = user.name;
  $("welcomeName").textContent = user.name;
  $("avatarImg").src = user.avatar || "https://via.placeholder.com/120?text=U";

  renderDists();
}

/* ============= SECCIONES (3) ============= */
function renderDists(){
  const email = localStorage.getItem("capu_current");
  const user = users[email];
  const cont = $("distsContainer");
  cont.innerHTML = "";

  user.dists.forEach((d,idx)=>{
    let box = document.createElement("div");
    box.className = "dist";

    box.innerHTML = `
      <h3 contenteditable="true" class="t">${d.title}</h3>
      <textarea class="desc">${d.text}</textarea>

      <div class="file-row">
        <label>Video <input type="file" class="upVideo" accept="video/*" hidden></label>
        <label>PDF <input type="file" class="upPdf" accept="application/pdf" hidden></label>
        <button class="btn saveBtn" style="padding:6px 12px">Guardar</button>
      </div>

      <div class="preview"></div>
    `;

    let preview = box.querySelector(".preview");
    drawPreview();

    function drawPreview(){
      preview.innerHTML = "";
      d.media.forEach(m=>{
        let div = document.createElement("div");
        div.className = "preview-item";
        div.textContent = m.type === "video" ? "ðŸŽ¬ Video" : "ðŸ“„ PDF";
        div.onclick = ()=> openModal(m.url, m.type);
        preview.appendChild(div);
      });
    }

    box.querySelector(".upVideo").onchange = e=>{
      let f = e.target.files[0];
      if(!f) return;
      d.media.push({type:"video",url:URL.createObjectURL(f)});
      save();
    };

    box.querySelector(".upPdf").onchange = e=>{
      let f = e.target.files[0];
      if(!f) return;
      d.media.push({type:"pdf",url:URL.createObjectURL(f)});
      save();
    };

    box.querySelector(".saveBtn").onclick = ()=>{
      d.title = box.querySelector(".t").textContent.trim();
      d.text = box.querySelector(".desc").value.trim();
      save();
    };

    function save(){
      users[email].dists[idx] = d;
      localStorage.setItem("capu_users",JSON.stringify(users));
      drawPreview();
    }

    cont.appendChild(box);
  });
}

/* ============= AVATAR ============= */
$("avatarWrap").onclick = ()=> $("avatarFile").click();
$("avatarFile").onchange = e=>{
  const f = e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    const email = localStorage.getItem("capu_current");
    users[email].avatar = reader.result;
    localStorage.setItem("capu_users",JSON.stringify(users));
    $("avatarImg").src = reader.result;
  };
  reader.readAsDataURL(f);
};

/* ============= MODAL PARA VER PDF/VIDEO ============= */
function openModal(url,type){
  $("modalContent").innerHTML = "";
  if(type==="video"){
    let v = document.createElement("video");
    v.controls = true;
    v.src = url;
    v.style.width = "100%";
    $("modalContent").appendChild(v);
  } else {
    let f = document.createElement("iframe");
    f.src = url;
    f.style.width = "100%";
    f.style.height = "600px";
    $("modalContent").appendChild(f);
  }

  $("modalView").style.display="flex";
}

$("closeModal").onclick = ()=> $("modalView").style.display="none";

</script>
</body>
</html>
